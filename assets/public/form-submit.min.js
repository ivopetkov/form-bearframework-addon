/*
 * Form addon for Bear Framework
 * https://github.com/ivopetkov/form-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.formSubmit=ivoPetkov.bearFrameworkAddons.formSubmit||(()=>{var e=null,t=[],r=function(e){var t=e.getBoundingClientRect();return[t.width,t.height]},n=function(e){var t=e.getBoundingClientRect(),r=Math.round(t.left),n=Math.round(t.top);return[r+=window.pageXOffset,n+=window.pageYOffset]},o=function(e,o){for(var a=0;a<1e3;a++){var i=n(e);if(0!==i[0]||0!==i[1])break;e=e.parentNode}if(null!==e&&void 0!==e.tagName){var l=document.createElement("a");l.setAttribute("data-form-component","tooltip"),l.innerText=o,l.style.left="-1000px",l.style.top="-1000px";var s=function(e){for(;e.parentNode&&void 0!==e.parentNode.tagName;){var t=window.getComputedStyle(e,null);if(null===t)return null;if("fixed"===t.position&&null!==e.getAttribute("data-form-tooltip-container"))return e;e=e.parentNode}return null}(e),u=null!==s,d=!u&&function(e){for(;e.parentNode&&void 0!==e.parentNode.tagName;){var t=window.getComputedStyle(e,null);if(null===t)return!1;if("fixed"===t.position)return!0;e=e.parentNode}return!1}(e);d&&(l.style.position="fixed"),u?s.appendChild(l):document.body.appendChild(l);var v=function(){var t=n(e),o=r(e),a=r(l),i=getComputedStyle(l).getPropertyValue("--form-tooltip-arrow-size"),v=t[0]+(o[0]-a[0])/2;v<5&&(v=5);var f=t[1]-a[1]-2;if(u){var c=n(s);v-=c[0]-s.scrollLeft,f-=c[1]-s.scrollTop}else d&&(v-=window.pageXOffset,f-=window.pageYOffset);l.style.left=v+"px",l.style.top="calc("+f+"px - "+i+")"};v(),l.scrollIntoView();var f=window.setInterval(v,100),c=function(){try{l.parentNode.removeChild(l)}catch(e){}window.removeEventListener("click",c),window.removeEventListener("keydown",c),window.clearInterval(f)};window.addEventListener("click",c),window.addEventListener("keydown",c),t.push(c)}};return{initialize:t=>{null===e&&(e={filesUploadUrl:t[0]})},submit:(r,n,a,i)=>{for(var l={},s=0;s<t.length;s++)t[s]();t=[];for(var u=async()=>{await a("submitend"),await i()},d=async()=>{await a("submiterror"),await u()},v=function(e){var t=r.querySelector('[data-form-element-type="submit-button"]');null!==t?o(t,e):alert(e)},f=function(){var e={};e.serverData=n.serverData,e.values=JSON.stringify(l),clientPackages.get("serverRequests").then((function(t){t.send("ivopetkov-form",e).then(async e=>{try{var t=JSON.parse(e)}catch(e){t={}}if(void 0!==t.status)if("0"===t.status){if(await d(),void 0!==t.error.element&&t.error.element.length>0){var n=r.querySelector('[name="'+t.error.element+'"]');null!==n&&n.focus()}void 0!==t.error.message&&t.error.message.length>0&&(void 0!==t.error.element&&t.error.element.length>0&&null!==n?o(n,t.error.message):v(t.error.message))}else"1"===t.status&&await(async e=>{await a("submitsuccess",{result:e}),await u()})(t.result);else await d()}).catch(async()=>{await d(),v(n.errorMessage)})}))},c={},p=!1,m=function(e,t){for(var r in c[e]=1,l[e]={type:"file",value:t},c)if(null===c[r])return;f()},w=r.querySelectorAll("input, select, textarea"),g=w.length,y=0;y<g;y++){var h=w[y];if(h.name.length>0){var b=h.name,k=h.getAttribute("type");null===k&&(k="text"),"file"===k?void 0!==h.files&&h.files.length>0?function(t){c[t]=null;var r=new XMLHttpRequest;r.addEventListener("load",(function(){200===r.status&&r.responseText.indexOf('"filename":')>0?m(t,r.responseText):d()})),r.addEventListener("error",(function(){d()})),r.addEventListener("abort",(function(){d()})),r.addEventListener("timeout",(function(){d()}));for(var n=new FormData,o=0;o<h.files.length;o++)n.append("file"+o,h.files[o]);r.open("POST",e.filesUploadUrl,!0),r.send(n),p=!0}(b):l[b]={type:k,value:""}:"checkbox"===k||"radio"===k?h.checked&&(l[b]={type:k,value:h.value}):l[b]={type:k,value:h.value}}}p||f()}}})();