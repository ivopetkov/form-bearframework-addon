/*
 * Form addon for Bear Framework
 * https://github.com/ivopetkov/form-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.formSubmit=ivoPetkov.bearFrameworkAddons.formSubmit||(()=>{var e=null,t=function(e){var t=e.getBoundingClientRect();return[t.width,t.height]},r=function(e){var t=e.getBoundingClientRect(),r=Math.round(t.left),a=Math.round(t.top);return[r+=window.pageXOffset,a+=window.pageYOffset]},a=function(a,n){for(var o=0;o<1e3;o++){var i=r(a);if(0!==i[0]||0!==i[1])break;a=a.parentNode}if(null!==a&&void 0!==a.tagName){var l=document.createElement("a");l.setAttribute("data-form-component","tooltip"),l.className=e.errorTooltipData.className,l.innerText=n,l.style.left="-1000px",l.style.top="-1000px";var s=function(e){for(;e.parentNode&&void 0!==e.parentNode.tagName;){var t=window.getComputedStyle(e,null);if(null===t)return!1;if("fixed"===t.position)return!0;e=e.parentNode}return!1}(a);s&&(l.style.position="fixed"),document.body.appendChild(l);var u=function(){var n=r(a),o=t(a),i=t(l),u=n[0]+(o[0]-i[0])/2;u<5&&(u=5);var d=n[1]-i[1]-2;s&&(u-=window.pageXOffset,d-=window.pageYOffset),l.style.left=u+"px",l.style.top="calc("+d+"px - "+e.errorTooltipData.arrowSize+")"};u();var d=window.setInterval(u,100),v=function(){l.parentNode.removeChild(l),window.removeEventListener("click",v),window.clearInterval(d)};window.addEventListener("click",v)}};return{initialize:t=>{null===e&&(e={errorTooltipData:t[0],filesUploadUrl:t[1]})},submit:(t,r,n,o)=>{for(var i={},l=async()=>{await n("submitend"),await o()},s=async()=>{await n("submiterror"),await l()},u=function(){var e={};e.serverData=r.serverData,e.values=JSON.stringify(i),clientPackages.get("serverRequests").then((function(o){o.send("ivopetkov-form",e).then(async e=>{try{var r=JSON.parse(e)}catch(e){r={}}if(void 0!==r.status)if("0"===r.status){if(await s(),void 0!==r.error.element&&r.error.element.length>0){var o=t.querySelector('[name="'+r.error.element+'"]');null!==o&&o.focus()}void 0!==r.error.message&&r.error.message.length>0&&(void 0!==r.error.element&&r.error.element.length>0&&null!==o?a(o,r.error.message):a(t,r.error.message))}else"1"===r.status&&await(async e=>{await n("submitsuccess",{result:e}),await l()})(r.result);else await s()}).catch(async()=>{await s(),a(t,r.errorMessage)})}))},d={},v=!1,f=function(e,t){for(var r in d[e]=1,i[e]={type:"file",value:t},d)if(null===d[r])return;u()},c=t.querySelectorAll("input, select, textarea"),p=c.length,m=0;m<p;m++){var w=c[m];if(w.name.length>0){var g=w.name,y=w.getAttribute("type");null===y&&(y="text"),"file"===y?void 0!==w.files&&w.files.length>0?function(t){d[t]=null;var r=new XMLHttpRequest;r.addEventListener("load",(function(){200===r.status&&r.responseText.indexOf('"filename":')>0?f(t,r.responseText):s()})),r.addEventListener("error",(function(){s()})),r.addEventListener("abort",(function(){s()})),r.addEventListener("timeout",(function(){s()}));for(var a=new FormData,n=0;n<w.files.length;n++)a.append("file"+n,w.files[n]);r.open("POST",e.filesUploadUrl,!0),r.send(a),v=!0}(g):i[g]={type:y,value:""}:"checkbox"===y||"radio"===y?w.checked&&(i[g]={type:y,value:w.value}):i[g]={type:y,value:w.value}}}v||u()}}})();