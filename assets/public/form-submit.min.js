/*
 * Form addon for Bear Framework
 * https://github.com/ivopetkov/form-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.formSubmit=ivoPetkov.bearFrameworkAddons.formSubmit||(()=>{var e=null,t=[],r=function(e){var t=e.getBoundingClientRect();return[t.width,t.height]},a=function(e){var t=e.getBoundingClientRect(),r=Math.round(t.left),a=Math.round(t.top);return[r+=window.pageXOffset,a+=window.pageYOffset]},n=function(n,o){for(var i=0;i<1e3;i++){var l=a(n);if(0!==l[0]||0!==l[1])break;n=n.parentNode}if(null!==n&&void 0!==n.tagName){var s=document.createElement("a");s.setAttribute("data-form-component","tooltip"),s.className=e.errorTooltipData.className,s.innerText=o,s.style.left="-1000px",s.style.top="-1000px";var u=function(e){for(;e.parentNode&&void 0!==e.parentNode.tagName;){var t=window.getComputedStyle(e,null);if(null===t)return!1;if("fixed"===t.position)return!0;e=e.parentNode}return!1}(n);u&&(s.style.position="fixed"),document.body.appendChild(s);var d=function(){var t=a(n),o=r(n),i=r(s),l=t[0]+(o[0]-i[0])/2;l<5&&(l=5);var d=t[1]-i[1]-2;u&&(l-=window.pageXOffset,d-=window.pageYOffset),s.style.left=l+"px",s.style.top="calc("+d+"px - "+e.errorTooltipData.arrowSize+")"};d();var v=window.setInterval(d,100),f=function(){try{s.parentNode.removeChild(s)}catch(e){}window.removeEventListener("click",f),window.clearInterval(v)};window.addEventListener("click",f),t.push(f)}};return{initialize:t=>{null===e&&(e={errorTooltipData:t[0],filesUploadUrl:t[1]})},submit:(r,a,o,i)=>{for(var l={},s=0;s<t.length;s++)t[s]();t=[];for(var u=async()=>{await o("submitend"),await i()},d=async()=>{await o("submiterror"),await u()},v=function(){var e={};e.serverData=a.serverData,e.values=JSON.stringify(l),clientPackages.get("serverRequests").then((function(t){t.send("ivopetkov-form",e).then(async e=>{try{var t=JSON.parse(e)}catch(e){t={}}if(void 0!==t.status)if("0"===t.status){if(await d(),void 0!==t.error.element&&t.error.element.length>0){var a=r.querySelector('[name="'+t.error.element+'"]');null!==a&&a.focus()}void 0!==t.error.message&&t.error.message.length>0&&(void 0!==t.error.element&&t.error.element.length>0&&null!==a?n(a,t.error.message):n(r,t.error.message))}else"1"===t.status&&await(async e=>{await o("submitsuccess",{result:e}),await u()})(t.result);else await d()}).catch(async()=>{await d(),n(r,a.errorMessage)})}))},f={},c=!1,p=function(e,t){for(var r in f[e]=1,l[e]={type:"file",value:t},f)if(null===f[r])return;v()},m=r.querySelectorAll("input, select, textarea"),w=m.length,g=0;g<w;g++){var h=m[g];if(h.name.length>0){var y=h.name,k=h.getAttribute("type");null===k&&(k="text"),"file"===k?void 0!==h.files&&h.files.length>0?function(t){f[t]=null;var r=new XMLHttpRequest;r.addEventListener("load",(function(){200===r.status&&r.responseText.indexOf('"filename":')>0?p(t,r.responseText):d()})),r.addEventListener("error",(function(){d()})),r.addEventListener("abort",(function(){d()})),r.addEventListener("timeout",(function(){d()}));for(var a=new FormData,n=0;n<h.files.length;n++)a.append("file"+n,h.files[n]);r.open("POST",e.filesUploadUrl,!0),r.send(a),c=!0}(y):l[y]={type:k,value:""}:"checkbox"===k||"radio"===k?h.checked&&(l[y]={type:k,value:h.value}):l[y]={type:k,value:h.value}}}c||v()}}})();