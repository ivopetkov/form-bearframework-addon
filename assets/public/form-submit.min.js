/*
 * Form addon for Bear Framework
 * https://github.com/ivopetkov/form-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.formSubmit=ivoPetkov.bearFrameworkAddons.formSubmit||(()=>{var e=null,t=[],n=function(e){var t=e.getBoundingClientRect();return[t.width,t.height]},r=function(e){var t=e.getBoundingClientRect(),n=Math.round(t.left),r=Math.round(t.top);return[n+=window.pageXOffset,r+=window.pageYOffset]},o=function(e,o){for(var a=0;a<1e3;a++){var i=r(e);if(0!==i[0]||0!==i[1])break;e=e.parentNode}if(null!==e&&void 0!==e.tagName){var l=document.createElement("a");l.setAttribute("data-form-component","tooltip"),l.innerText=o,l.style.left="-1000px",l.style.top="-1000px";var s=function(e){for(;e.parentNode&&void 0!==e.parentNode.tagName;){var t=window.getComputedStyle(e,null);if(null===t)return null;if("fixed"===t.position&&null!==e.getAttribute("data-form-tooltip-container"))return e;e=e.parentNode}return null}(e),u=null!==s,d=!u&&function(e){for(;e.parentNode&&void 0!==e.parentNode.tagName;){var t=window.getComputedStyle(e,null);if(null===t)return!1;if("fixed"===t.position)return!0;e=e.parentNode}return!1}(e);d&&(l.style.position="fixed"),u?s.appendChild(l):document.body.appendChild(l);var f=function(){var t=r(e),o=n(e),a=n(l),i=getComputedStyle(l).getPropertyValue("--form-tooltip-arrow-size"),f=t[0]+(o[0]-a[0])/2;f<5&&(f=5);var v=t[1]-a[1]-2;if(u){var c=r(s);f-=c[0]-s.scrollLeft,v-=c[1]-s.scrollTop}else d&&(f-=window.pageXOffset,v-=window.pageYOffset);l.style.left=f+"px",l.style.top="calc("+v+"px - "+i+")"};f(),function(e){var t=e.getBoundingClientRect();return t.bottom<0||t.right<0||t.left>window.innerWidth||t.top>window.innerHeight}(l)&&l.scrollIntoView();var v=window.setInterval(f,100),c=function(){try{l.parentNode.removeChild(l)}catch(e){}window.removeEventListener("click",c),window.removeEventListener("keydown",c),window.clearInterval(v)};window.addEventListener("click",c),window.addEventListener("keydown",c),t.push(c)}};return{initialize:t=>{null===e&&(e={filesUploadUrl:t[0]})},submit:(n,r,a,i)=>{for(var l={},s=0;s<t.length;s++)t[s]();t=[];for(var u=async()=>{await a("submitend"),await i()},d=async()=>{await a("submiterror"),await u()},f=function(e){var t=n.querySelector('[data-form-element-type="submit-button"]');null!==t?o(t,e):alert(e)},v=function(){var e={};e.serverData=r.serverData,e.values=JSON.stringify(l),clientPackages.get("serverRequests").then((function(t){t.send("ivopetkov-form",e).then(async e=>{try{var t=JSON.parse(e)}catch(e){t={}}if(void 0!==t.status)if("0"===t.status){if(await d(),void 0!==t.error.element&&t.error.element.length>0){var r=n.querySelector('[name="'+t.error.element+'"]');null!==r&&r.focus()}void 0!==t.error.message&&t.error.message.length>0&&(void 0!==t.error.element&&t.error.element.length>0&&null!==r?o(r,t.error.message):f(t.error.message))}else"1"===t.status&&await(async e=>{await a("submitsuccess",{result:e}),await u()})(t.result);else await d()}).catch(async()=>{await d(),f(r.errorMessage)})}))},c={},p=!1,w=function(e,t){for(var n in c[e]=1,l[e]={type:"file",value:t},c)if(null===c[n])return;v()},m=n.querySelectorAll("input, select, textarea"),g=m.length,y=0;y<g;y++){var h=m[y];if(h.name.length>0){var b=h.name,k=h.getAttribute("type");null===k&&(k="text"),"file"===k?void 0!==h.files&&h.files.length>0?function(t){c[t]=null;var n=new XMLHttpRequest;n.addEventListener("load",(function(){200===n.status&&n.responseText.indexOf('"filename":')>0?w(t,n.responseText):d()})),n.addEventListener("error",(function(){d()})),n.addEventListener("abort",(function(){d()})),n.addEventListener("timeout",(function(){d()}));for(var r=new FormData,o=0;o<h.files.length;o++)r.append("file"+o,h.files[o]);n.open("POST",e.filesUploadUrl,!0),n.send(r),p=!0}(b):l[b]={type:k,value:""}:"checkbox"===k||"radio"===k?h.checked&&(l[b]={type:k,value:h.value}):l[b]={type:k,value:h.value}}}p||v()}}})();