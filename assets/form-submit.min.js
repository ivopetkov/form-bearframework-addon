/*
 * Form addon for Bear Framework
 * https://github.com/ivopetkov/form-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{};
ivoPetkov.bearFrameworkAddons.formSubmit=ivoPetkov.bearFrameworkAddons.formSubmit||function(){var n=null,p=function(a){a=a.getBoundingClientRect();return[a.width,a.height]},v=function(a){for(;a.parentNode&&"undefined"!==typeof a.parentNode.tagName;){var g=window.getComputedStyle(a,null);if(null===g)break;if("fixed"===g.position)return!0;a=a.parentNode}return!1},r=function(a,g){var d=document.createElement("a");d.className=n.errorTooltipData.className;d.innerText=g;d.style.left="-1000px";d.style.top=
"-1000px";var l=v(a);l&&(d.style.position="fixed");document.body.appendChild(d);var c=function(){var e=a.getBoundingClientRect();var f=Math.round(e.left);e=Math.round(e.top);f+=window.pageXOffset;e+=window.pageYOffset;f=[f,e];var c=p(a);e=p(d);c=f[0]+(c[0]-e[0])/2;5>c&&(c=5);f=f[1]-e[1]-2;l&&(c-=window.pageXOffset,f-=window.pageYOffset);d.style.left=c+"px";d.style.top="calc("+f+"px - "+n.errorTooltipData.arrowSize+")"};c();var q=window.setInterval(c,100),k=function(){d.parentNode.removeChild(d);window.removeEventListener("click",
k);window.clearInterval(q)};window.addEventListener("click",k)};return{initialize:function(a){n={errorTooltipData:a[0],filesUploadUrl:a[1]}},submit:function(a,g){for(var d={},l=function(){var c=document.createEvent("Event");c.initEvent("submitend",!1,!1);a.dispatchEvent(c);g.status=0},c=function(){var c=document.createEvent("Event");c.initEvent("submiterror",!1,!1);a.dispatchEvent(c);l()},q=function(){var e={};e.serverData=g.serverData;e.values=JSON.stringify(d);clientShortcuts.get("serverRequests").then(function(d){d.send("ivopetkov-form",
e).then(function(d){try{var b=JSON.parse(d)}catch(w){b={}}if("undefined"!==typeof b.status)if("0"===b.status){c();if("undefined"!==typeof b.error.element&&0<b.error.element.length){var e=a.querySelector('[name="'+b.error.element+'"]');null!==e&&e.focus()}"undefined"!==typeof b.error.message&&0<b.error.message.length&&("undefined"!==typeof b.error.element&&0<b.error.element.length&&null!==e?r(e,b.error.message):r(a,b.error.message))}else"1"===b.status&&(d=b.result,b=document.createEvent("Event"),b.initEvent("submitsuccess",
!1,!1),b.result=d,a.dispatchEvent(b),l());else c()})["catch"](function(){c();r(a,g.errorMessage)})})},k={},e=!1,f=a.querySelectorAll("input, select, textarea"),p=f.length,t=0;t<p;t++){var h=f[t];if(0<h.name.length){var u=h.name,m=h.getAttribute("type");null===m&&(m="text");"file"===m?"undefined"!==typeof h.files&&0<h.files.length?function(a){k[a]=null;var f=new XMLHttpRequest;f.addEventListener("load",function(){if(200===f.status&&0<f.responseText.indexOf('"filename":'))a:{var b=f.responseText;k[a]=
1;d[a]={type:"file",value:b};for(var e in k)if(null===k[e])break a;q()}else c()});f.addEventListener("error",function(){c()});f.addEventListener("abort",function(){c()});f.addEventListener("timeout",function(){c()});for(var g=new FormData,b=0;b<h.files.length;b++)g.append("file"+b,h.files[b]);f.open("POST",n.filesUploadUrl,!0);f.send(g);e=!0}(u):d[u]={type:m,value:""}:d[u]={type:m,value:h.value}}}e||q()}}}();