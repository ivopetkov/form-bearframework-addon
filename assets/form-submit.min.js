/*
 * Form addon for Bear Framework
 * https://github.com/ivopetkov/form-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{};
ivoPetkov.bearFrameworkAddons.formSubmit=ivoPetkov.bearFrameworkAddons.formSubmit||function(){var q=null,l=function(a){a=a.getBoundingClientRect();return[a.width,a.height]},r=function(a){for(;a.parentNode&&"undefined"!==typeof a.parentNode.tagName;){var g=window.getComputedStyle(a,null);if(null===g)break;if("fixed"===g.position)return!0;a=a.parentNode}return!1},t=function(a,g){var b=document.createElement("a");b.className=q.errorTooltipData.className;b.innerText=g;b.style.left="-1000px";b.style.top=
"-1000px";var m=r(a);m&&(b.style.position="fixed");document.body.appendChild(b);var k=function(){var e=a.getBoundingClientRect();var d=Math.round(e.left);e=Math.round(e.top);d+=window.pageXOffset;e+=window.pageYOffset;d=[d,e];var f=l(a);e=l(b);f=d[0]+(f[0]-e[0])/2;5>f&&(f=5);d=d[1]-e[1]-2;m&&(f-=window.pageXOffset,d-=window.pageYOffset);b.style.left=f+"px";b.style.top="calc("+d+"px - "+q.errorTooltipData.arrowSize+")"};k();var f=window.setInterval(k,100),n=function(){b.parentNode.removeChild(b);window.removeEventListener("click",
n);window.clearInterval(f)};window.addEventListener("click",n)};return{initialize:function(a){q={errorTooltipData:a[0],filesUploadUrl:a[1]}},submit:function(a,g,b,m){for(var k={},f=function(){b("submiterror");b("submitend");m()},n=function(){var e={};e.serverData=g.serverData;e.values=JSON.stringify(k);clientShortcuts.get("serverRequests").then(function(d){d.send("ivopetkov-form",e).then(function(e){try{var c=JSON.parse(e)}catch(w){c={}}if("undefined"!==typeof c.status)if("0"===c.status){f();if("undefined"!==
typeof c.error.element&&0<c.error.element.length){var d=a.querySelector('[name="'+c.error.element+'"]');null!==d&&d.focus()}"undefined"!==typeof c.error.message&&0<c.error.message.length&&("undefined"!==typeof c.error.element&&0<c.error.element.length&&null!==d?t(d,c.error.message):t(a,c.error.message))}else"1"===c.status&&(b("submitsuccess",{result:c.result}),b("submitend"),m());else f()})["catch"](function(){f();t(a,g.errorMessage)})})},e={},d=!1,l=a.querySelectorAll("input, select, textarea"),
r=l.length,u=0;u<r;u++){var h=l[u];if(0<h.name.length){var v=h.name,p=h.getAttribute("type");null===p&&(p="text");"file"===p?"undefined"!==typeof h.files&&0<h.files.length?function(a){e[a]=null;var b=new XMLHttpRequest;b.addEventListener("load",function(){if(200===b.status&&0<b.responseText.indexOf('"filename":'))a:{var c=b.responseText;e[a]=1;k[a]={type:"file",value:c};for(var d in e)if(null===e[d])break a;n()}else f()});b.addEventListener("error",function(){f()});b.addEventListener("abort",function(){f()});
b.addEventListener("timeout",function(){f()});for(var g=new FormData,c=0;c<h.files.length;c++)g.append("file"+c,h.files[c]);b.open("POST",q.filesUploadUrl,!0);b.send(g);d=!0}(v):k[v]={type:p,value:""}:k[v]={type:p,value:h.value}}}d||n()}}}();