<?php

/*
 * Form addon for Bear Framework
 * https://github.com/ivopetkov/form-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.form=ivoPetkov.bearFrameworkAddons.form||function(){var t=[],e=function(e){return void 0!==t[e]?document.querySelector('form[data-form-id="'+e+'"]'):null},r=async r=>{var o=e(r);if(null!==o){var a=t[r];if(1===a.status)return;var u=function(t){void 0===t&&(t=a.errorMessage);var e=o.querySelector('[data-form-element-type="submit-button"]');null!==e?i(e,t):alert(t)},s=function(t,e){i(t,e)},l=async(t,e,r)=>{var n=function(t,e){if(void 0===e&&(e=!1),"function"==typeof Event)return new Event(t,{cancelable:e});var r=document.createEvent("Event");return r.initEvent(t,!1,!1),r}(t,r);if(void 0!==e)for(var i in e)n[i]=e[i];n.promisesToWait=[];var a=o.dispatchEvent(n);return n.promisesToWait.length>0&&await Promise.allSettled(n.promisesToWait),a};if(!await l("beforesubmit",{},!0))return;a.status=1,n(r,!0),await l("submitstart");var f=async()=>{await l("submitend"),a.status=0,n(r,!1)},v=async t=>{await l("submitsuccess",{result:t}),await f()},c=async(t,e,r)=>{void 0===t&&(t=""),void 0===e&&(e="");var n=await l("submiterror",{errorMessage:t,errorElement:e},!0);return await f(),r&&n&&u(),n};clientPackages.get("-form-submit").then((function(t){t.submit(o,a,u,s,v,c)})).catch(async()=>{await c()&&u()})}},n=function(t,r){var n=e(t);null!==n&&(r?n.setAttribute("inert","true"):n.removeAttribute("inert"))},i=function(t,e){for(var r=0;r<1e3;r++){var n=t.getBoundingClientRect();if(0!==n.width||0!==n.height)break;t=t.parentNode}var i;null!==t&&void 0!==t.tagName&&(((i=t.getBoundingClientRect()).bottom<0||i.right<0||i.left>window.innerWidth||i.top>window.innerHeight)&&t.scrollIntoView(),clientPackages.get("tooltip").then((function(r){r.show("ip-form-tooltip",t,"",{preferedPositions:["top","bottom","right","left"],hideOnClick:!0,hideOnKeyDown:!0,onBeforeShow:function(t){t.setAttribute("data-form-component","tooltip"),t.innerText=e}})})))};return{initialize:function(n){var i=n[0];t[i]={serverData:n[1],errorMessage:n[2],status:0};var o=n[3],a=e(i);if(null!==a){a.submit=function(){r(i)};var u=function(t){var e=a.getAttribute("on"+t);null!==e&&a.addEventListener(t,(function(t){new Function("return function(event){"+e+"}")().bind(this)(t)}))};u("beforesubmit"),u("submitstart"),u("submitend"),u("submitsuccess"),u("submiterror");for(var s=function(t){void 0===t&&(t=null);for(var e=a.querySelectorAll("[data-form-element-type]"),r=[],n=0;n<e.length;n++){var i=e[n];(null===t||null!==i.querySelector('[name="'+t+'"]'))&&r.push(i)}return r},l=function(t){if("AND"===t[0]||"OR"===t[0]){for(var e="AND"===t[0],r=!1,n=1;n<t.length;n++)if(l(t[n])){if(!e){r=!0;break}var r=!0}else if(e)return!1;return r}var i=t[0],o=t[1];if("value"===o){var a=t[2],u=function(t){var e=s(t);if(e.length>0){if("radio"!==e[0].getAttribute("data-form-element-type"))return e[0].getValue();for(var r=0;r<e.length;r++)if(e[r].isChecked())return e[r].getValue()}return null}(i);if("string"!=typeof a){if(-1!==a.indexOf(u))return!0}else if(u===a)return!0}else if("checked"===o){var f=s(i);if(f.length>0&&"checkbox"===f[0].getAttribute("data-form-element-type"))return f[0].isChecked()}return!1},f=function(t){var e=[];if("AND"===t[0]||"OR"===t[0]){for(var r=1;r<t.length;r++)e=e.concat(f(t[r]));return e}return e.push(t[0]),e},v=[],c=0;c<o.length;c++){var d=o[c][2];v=v.concat(f(d))}var m=function(){for(var t=0;t<o.length;t++){var e=o[t][1],r=o[t][2],n=s(e);if("visible"===o[t][0])for(var i=l(r),a=0;a<n.length;a++)void 0!==n[a].setVisibility&&n[a].setVisibility(i)}},b=[];for(c=0;c<v.length;c++){var g=v[c];if(void 0===b[g]){b[g]=1;for(var h=s(g),w=0;w<h.length;w++)h[w].addEventListener("change",m)}}var p=function(){r(i);for(var t=s(),e=0;e<t.length;e++){var n=t[e];if("submit-button"===n.getAttribute("data-form-element-type")){n.scrollIntoView(!1);break}}},y=s();for(c=0;c<y.length;c++){var k=y[c];"textbox"===k.getAttribute("data-form-element-type")&&k.addEventListener("keydown",(function(t){13===t.keyCode&&p()}))}a.addEventListener("reset",(function(){for(var t=a.querySelectorAll("input, select, textarea"),e=t.length,r=0;r<e;r++){t[r].dispatchEvent(new Event("change"))}}))}},submit:r,showTooltip:i}}();
EOT;