<?php

/*
 * Form addon for Bear Framework
 * https://github.com/ivopetkov/form-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.form=ivoPetkov.bearFrameworkAddons.form||function(){var t=[],e=function(e){return void 0!==t[e]?document.querySelector('form[data-form-id="'+e+'"]'):null},r=async r=>{var n=e(r);if(null!==n){var a=t[r];if(1===a.status)return;var o=async(t,e)=>{var r=function(t){if("function"==typeof Event)return new Event(t);var e=document.createEvent("Event");return e.initEvent(t,!1,!1),e}(t);if(void 0!==e)for(var i in e)r[i]=e[i];var a=!1;"true"===n.getAttribute("disabled")&&(n.removeAttribute("disabled"),a=!0),r.promisesToWait=[];var o=n.dispatchEvent(r);return r.promisesToWait.length>0&&await Promise.allSettled(r.promisesToWait),a&&n.setAttribute("disabled","true"),o};if(!await o("beforesubmit"))return;a.status=1,i(r,!0),await o("submitstart"),clientPackages.get("-form-submit").then((function(t){t.submit(n,a,o,()=>{a.status=0,i(r,!1)})}))}},i=function(t,r){var i=e(t);if(null!==i){r?i.setAttribute("disabled","true"):i.removeAttribute("disabled");for(var n=i.querySelectorAll("input, select, textarea"),a=n.length,o=0;o<a;o++){var s=n[o];r?(s.setAttribute("disabled","true"),s.ipfrmds=1):void 0!==s.ipfrmds&&(s.removeAttribute("disabled"),delete s.ipfrmds)}}};return{initialize:function(i){var n=i[0];t[n]={serverData:i[1],errorMessage:i[2],status:0};var a=e(n);if(null!==a){a.submit=function(){r(n)};var o=function(t){var e=a.getAttribute("on"+t);null!==e&&a.addEventListener(t,(function(t){new Function("return function(event){"+e+"}")().bind(this)(t)}))};o("beforesubmit"),o("submitstart"),o("submitend"),o("submitsuccess"),o("submiterror")}},submit:r}}();
EOT;
