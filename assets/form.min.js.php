<?php

/*
 * Form addon for Bear Framework
 * https://github.com/ivopetkov/form-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.form=ivoPetkov.bearFrameworkAddons.form||function(){var e=[],t=function(t){return void 0!==e[t]?document.querySelector('form[data-form-id="'+t+'"]'):null},r=async r=>{var n=t(r);if(null!==n){var a=e[r];if(1===a.status)return;var o=async(e,t)=>{var r=function(e){if("function"==typeof Event)return new Event(e);var t=document.createEvent("Event");return t.initEvent(e,!1,!1),t}(e);if(void 0!==t)for(var i in t)r[i]=t[i];var a=!1;"true"===n.getAttribute("disabled")&&(n.removeAttribute("disabled"),a=!0),r.promisesToWait=[];var o=n.dispatchEvent(r);return r.promisesToWait.length>0&&await Promise.allSettled(r.promisesToWait),a&&n.setAttribute("disabled","true"),o};if(!await o("beforesubmit"))return;a.status=1,i(r,!0),await o("submitstart"),clientPackages.get("-form-submit").then((function(e){e.submit(n,a,o,()=>{a.status=0,i(r,!1)})}))}},i=function(e,r){var i=t(e);if(null!==i){r?i.setAttribute("disabled","true"):i.removeAttribute("disabled");for(var n=i.querySelectorAll("input, select, textarea"),a=n.length,o=0;o<a;o++){var u=n[o];r?(u.setAttribute("disabled","true"),u.ipfrmds=1):void 0!==u.ipfrmds&&(u.removeAttribute("disabled"),delete u.ipfrmds)}}};return{initialize:function(i){var n=i[0];e[n]={serverData:i[1],errorMessage:i[2],status:0};var a=i[3],o=t(n);if(null!==o){o.submit=function(){r(n)};var u=function(e){var t=o.getAttribute("on"+e);null!==t&&o.addEventListener(e,(function(e){new Function("return function(event){"+t+"}")().bind(this)(e)}))};u("beforesubmit"),u("submitstart"),u("submitend"),u("submitsuccess"),u("submiterror");for(var s=function(e){for(var t=document.querySelectorAll("[data-form-element-type]"),r=[],i=0;i<t.length;i++)null!==t[i].querySelector('[name="'+e+'"]')&&r.push(t[i]);return r},v=function(e){if("AND"===e[0]||"OR"===e[0]){for(var t="AND"===e[0],r=!1,i=1;i<e.length;i++)if(v(e[i])){if(!t){r=!0;break}var r=!0}else if(t)return!1;return r}var n=e[0],a=e[1];if("value"===a){var o=e[2],u=function(e){var t=s(e);if(t.length>0){if("radio"!==t[0].getAttribute("data-form-element-type"))return t[0].getValue();for(var r=0;r<t.length;r++)if(t[r].isChecked())return t[r].getValue()}return null}(n);if("string"!=typeof o){if(-1!==o.indexOf(u))return!0}else if(u===o)return!0}else if("checked"===a){var f=s(n);if(f.length>0&&"checkbox"===f[0].getAttribute("data-form-element-type"))return f[0].isChecked()}return!1},f=function(e){var t=[];if("AND"===e[0]||"OR"===e[0]){for(var r=1;r<e.length;r++)t=t.concat(f(e[r]));return t}return t.push(e[0]),t},l=[],d=0;d<a.length;d++){var c=a[d][2];l=l.concat(f(c))}var b=function(){for(var e=0;e<a.length;e++){var t=a[e][1],r=a[e][2],i=s(t);if("visible"===a[e][0])for(var n=v(r),o=0;o<i.length;o++)void 0!==i[o].setVisibility&&i[o].setVisibility(n)}},m=[];for(d=0;d<l.length;d++){var g=l[d];if(void 0===m[g]){m[g]=1;for(var h=s(g),A=0;A<h.length;A++)h[A].addEventListener("change",b)}}}},submit:r}}();
EOT;
