<?php

/*
 * Form addon for Bear Framework
 * https://github.com/ivopetkov/form-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.form=ivoPetkov.bearFrameworkAddons.form||function(){var e=[],t=function(t){return void 0!==e[t]?document.querySelector('form[data-form-id="'+t+'"]'):null},r=async r=>{var i=t(r);if(null!==i){var a=e[r];if(1===a.status)return;var o=async(e,t,r)=>{var n=function(e,t){if(void 0===t&&(t=!1),"function"==typeof Event)return new Event(e,{cancelable:t});var r=document.createEvent("Event");return r.initEvent(e,!1,!1),r}(e,r);if(void 0!==t)for(var a in t)n[a]=t[a];var o=!1;"true"===i.getAttribute("disabled")&&(i.removeAttribute("disabled"),o=!0),n.promisesToWait=[];var u=i.dispatchEvent(n);return n.promisesToWait.length>0&&await Promise.allSettled(n.promisesToWait),o&&i.setAttribute("disabled","true"),u};if(!await o("beforesubmit",{},!0))return;a.status=1,n(r,!0),await o("submitstart"),clientPackages.get("-form-submit").then((function(e){e.submit(i,a,o,()=>{a.status=0,n(r,!1)})}))}},n=function(e,r){var n=t(e);if(null!==n){r?n.setAttribute("disabled","true"):n.removeAttribute("disabled");for(var i=n.querySelectorAll("input, select, textarea"),a=i.length,o=0;o<a;o++){var u=i[o];r?(u.setAttribute("disabled","true"),u.ipfrmds=1):void 0!==u.ipfrmds&&(u.removeAttribute("disabled"),delete u.ipfrmds)}}};return{initialize:function(n){var i=n[0];e[i]={serverData:n[1],errorMessage:n[2],status:0};var a=n[3],o=t(i);if(null!==o){o.submit=function(){r(i)};var u=function(e){var t=o.getAttribute("on"+e);null!==t&&o.addEventListener(e,(function(e){new Function("return function(event){"+t+"}")().bind(this)(e)}))};u("beforesubmit"),u("submitstart"),u("submitend"),u("submitsuccess"),u("submiterror");for(var s=function(e){void 0===e&&(e=null);for(var t=o.querySelectorAll("[data-form-element-type]"),r=[],n=0;n<t.length;n++){var i=t[n];(null===e||null!==i.querySelector('[name="'+e+'"]'))&&r.push(i)}return r},v=function(e){if("AND"===e[0]||"OR"===e[0]){for(var t="AND"===e[0],r=!1,n=1;n<e.length;n++)if(v(e[n])){if(!t){r=!0;break}var r=!0}else if(t)return!1;return r}var i=e[0],a=e[1];if("value"===a){var o=e[2],u=function(e){var t=s(e);if(t.length>0){if("radio"!==t[0].getAttribute("data-form-element-type"))return t[0].getValue();for(var r=0;r<t.length;r++)if(t[r].isChecked())return t[r].getValue()}return null}(i);if("string"!=typeof o){if(-1!==o.indexOf(u))return!0}else if(u===o)return!0}else if("checked"===a){var l=s(i);if(l.length>0&&"checkbox"===l[0].getAttribute("data-form-element-type"))return l[0].isChecked()}return!1},l=function(e){var t=[];if("AND"===e[0]||"OR"===e[0]){for(var r=1;r<e.length;r++)t=t.concat(l(e[r]));return t}return t.push(e[0]),t},f=[],d=0;d<a.length;d++){var c=a[d][2];f=f.concat(l(c))}var b=function(){for(var e=0;e<a.length;e++){var t=a[e][1],r=a[e][2],n=s(t);if("visible"===a[e][0])for(var i=v(r),o=0;o<n.length;o++)void 0!==n[o].setVisibility&&n[o].setVisibility(i)}},m=[];for(d=0;d<f.length;d++){var g=f[d];if(void 0===m[g]){m[g]=1;for(var h=s(g),A=0;A<h.length;A++)h[A].addEventListener("change",b)}}var k=function(){r(i);for(var e=s(),t=0;t<e.length;t++){var n=e[t];if("submit-button"===n.getAttribute("data-form-element-type")){n.scrollIntoView(!1);break}}},p=s();for(d=0;d<p.length;d++){var y=p[d];"textbox"===y.getAttribute("data-form-element-type")&&y.addEventListener("keydown",(function(e){13===e.keyCode&&k()}))}o.addEventListener("reset",(function(){for(var e=o.querySelectorAll("input, select, textarea"),t=e.length,r=0;r<t;r++){e[r].dispatchEvent(new Event("change"))}}))}},submit:r}}();
EOT;